# 位置验证机器人

这是一个基于 Telegram Bot API 的位置验证机器人，用于检查用户分享的位置是否在管理员设置的指定范围内。所有用户共用一个全局位置验证范围。

## 功能特性

✅ **全局位置验证** - 管理员可设置统一的位置验证范围，所有用户共享同一设置
✅ **实时距离计算** - 精确计算用户位置与验证中心的距离
✅ **详细的验证记录** - 自动保存所有验证历史
✅ **管理员统计功能** - 查看验证通过率和历史数据
✅ **用户友好界面** - 提供简单的位置分享按钮

## 技术栈

- Python 3.8+
- python-telegram-bot 20.7
- geopy 2.3.0
- SQLite3 (内置数据库)

## 安装指南


###  配置机器人

编辑 `config.py` 文件，设置您的 Telegram Bot Token 和管理员 ID：

```python
# 配置文件
BOT_TOKEN = '您的Telegram Bot Token'   # Token   在这里获取@BotFather
ADMIN_IDS = '123456789'  # 管理员ID列表   在这里获取@userinfobot
```

###  运行机器人

```python
bot.py
```

## 使用说明

### 普通用户

1. 发送 `/start` 开始使用机器人
2. 点击「📍 分享位置」按钮分享您的实时位置
3. 机器人会自动验证您的位置是否在指定范围内


### 管理员命令

管理员可以使用以下命令进行管理操作：

- `/setlocation <纬度> <经度> <半径(米)>` - 设置全局位置验证范围
  - 例如：`/setlocation 40.7128 -74.0060 1000`

- `/settings` - 查看当前全局位置设置

- `/stats` - 查看验证统计数据
  - 包括总验证次数、通过率和最近24小时验证次数

- `/adminhelp` - 显示管理员命令帮助

## 数据库说明

机器人使用 SQLite 数据库 (`bot_data.db`) 存储：

1. **全局位置设置** - 管理员设置的验证区域信息
2. **用户验证记录** - 所有用户的位置验证历史

数据库会在首次运行时自动创建。

## 默认设置

首次运行时，如果没有设置位置范围，机器人会使用默认值：
- 纬度：40.7128（纽约市）
- 经度：-74.0060
- 半径：1000 米

管理员可以随时通过 `/setlocation` 命令修改这些设置。

## 注意事项

- 位置范围半径最大限制为 50 公里
- 所有用户共用同一位置验证范围
- 只有在 `ADMIN_IDS` 列表中的用户可以设置验证范围
- 验证结果会实时显示距离中心点的距离

## 错误处理

- 坐标格式错误时会显示详细的错误提示
- 未设置位置范围时，会提示用户联系管理员
- 非管理员尝试使用管理员命令时会被拒绝

## 许可证

本项目采用 MIT 许可证 - 详情请查看 [LICENSE](LICENSE) 文件

## 更新日志

### v1.0.0
- 初始版本发布
- 支持全局位置验证
- 管理员设置和统计功能
- 用户位置分享和验证